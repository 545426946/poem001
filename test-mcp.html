<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCPç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Supabase MCP ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div id="status">
        <h2>ç³»ç»ŸçŠ¶æ€</h2>
        <div id="connection-status" class="test-result">æ£€æŸ¥ä¸­...</div>
        <div id="health-status" class="test-result">æ£€æŸ¥ä¸­...</div>
        <div id="init-status" class="test-result">æ£€æŸ¥ä¸­...</div>
    </div>

    <div id="actions">
        <h2>æµ‹è¯•æ“ä½œ</h2>
        <button onclick="runQuickCheck()">å¿«é€Ÿæ£€æŸ¥</button>
        <button onclick="runFullCheck()">å®Œæ•´æ£€æŸ¥</button>
        <button onclick="testDataQuery()">æµ‹è¯•æ•°æ®æŸ¥è¯¢</button>
        <button onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
    </div>

    <div id="results">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="test-results"></div>
    </div>

    <script type="module">
        // åŠ¨æ€å¯¼å…¥MCPæ£€æŸ¥å·¥å…·
        async function runQuickCheck() {
            try {
                const mcpChecker = await import('./src/utils/mcp-check.js');
                const result = await mcpChecker.default.quickCheck();
                updateStatus('å¥åº·æ£€æŸ¥', result.healthy ? 'success' : 'error', 
                    `å¥åº·çŠ¶æ€: ${result.healthy ? 'æ­£å¸¸' : 'å¼‚å¸¸'}, æ¶ˆæ¯: ${result.message}`);
            } catch (error) {
                updateStatus('å¿«é€Ÿæ£€æŸ¥', 'error', `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        async function runFullCheck() {
            try {
                const mcpChecker = await import('./src/utils/mcp-check.js');
                const result = await mcpChecker.default.runComprehensiveCheck();
                updateStatus('å®Œæ•´æ£€æŸ¥', 'success', 'æ£€æŸ¥å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º');
            } catch (error) {
                updateStatus('å®Œæ•´æ£€æŸ¥', 'error', `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        async function testDataQuery() {
            try {
                const mcpService = await import('./src/services/mcpService.js');
                const poems = await mcpService.default.getPoemsData('all', 3);
                updateStatus('æ•°æ®æŸ¥è¯¢', 'success', 
                    `æŸ¥è¯¢æˆåŠŸï¼Œè·å–åˆ° ${poems.length} æ¡è¯—æ­Œæ•°æ®`);
                console.log('è¯—æ­Œæ•°æ®ç¤ºä¾‹:', poems);
            } catch (error) {
                updateStatus('æ•°æ®æŸ¥è¯¢', 'error', `æŸ¥è¯¢å¤±è´¥: ${error.message}`);
            }
        }

        async function testHealthCheck() {
            try {
                const mcpService = await import('./src/services/mcpService.js');
                const health = await mcpService.default.healthCheck();
                updateStatus('å¥åº·æ£€æŸ¥', health.healthy ? 'success' : 'warning', 
                    `æœåŠ¡çŠ¶æ€: ${health.healthy ? 'æ­£å¸¸' : 'å¼‚å¸¸'}, æ¶ˆæ¯: ${health.message}`);
            } catch (error) {
                updateStatus('å¥åº·æ£€æŸ¥', 'error', `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        function updateStatus(testName, type, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', async () => {
            // æ£€æŸ¥MCPåˆå§‹åŒ–çŠ¶æ€
            try {
                const mcpInit = await import('./src/config/mcp-init.js');
                const initialized = mcpInit.default.isInitialized();
                
                document.getElementById('init-status').className = `test-result ${initialized ? 'success' : 'warning'}`;
                document.getElementById('init-status').innerHTML = 
                    `åˆå§‹åŒ–çŠ¶æ€: ${initialized ? 'âœ… å·²åˆå§‹åŒ–' : 'âš ï¸ æœªåˆå§‹åŒ–'}`;
                
                // æ£€æŸ¥è¿æ¥çŠ¶æ€
                const mcpService = await import('./src/services/mcpService.js');
                const health = await mcpService.default.healthCheck();
                
                document.getElementById('health-status').className = `test-result ${health.healthy ? 'success' : 'warning'}`;
                document.getElementById('health-status').innerHTML = 
                    `å¥åº·çŠ¶æ€: ${health.healthy ? 'âœ… æ­£å¸¸' : 'âš ï¸ å¼‚å¸¸'} - ${health.message}`;
                
                document.getElementById('connection-status').className = `test-result ${health.healthy ? 'success' : 'warning'}`;
                document.getElementById('connection-status').innerHTML = 
                    `è¿æ¥çŠ¶æ€: ${health.healthy ? 'âœ… åœ¨çº¿' : 'âš ï¸ ç¦»çº¿'}`;
                    
            } catch (error) {
                document.getElementById('init-status').className = 'test-result error';
                document.getElementById('init-status').innerHTML = `åˆå§‹åŒ–æ£€æŸ¥å¤±è´¥: ${error.message}`;
            }
        });
    </script>
</body>
</html>